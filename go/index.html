<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Goes | 徐旭 的博客</title><meta name=keywords content><meta name=description content><meta name=author content="徐旭"><link rel=canonical href=https://allenxuxu.github.io/go/><link crossorigin=anonymous href=/assets/css/stylesheet.min.04512c372388e08b5118f5b117b2d3efef4ddae52017e16085c8d8d4e361c43d.css integrity="sha256-BFEsNyOI4ItRGPWxF7LT7+9N2uUgF+FghcjY1ONhxD0=" rel="preload stylesheet" as=style><link rel=icon href=https://allenxuxu.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://allenxuxu.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://allenxuxu.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://allenxuxu.github.io/apple-touch-icon.png><link rel=mask-icon href=https://allenxuxu.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.81.0"><link rel=alternate type=application/rss+xml href=https://allenxuxu.github.io/go/index.xml><meta property="og:title" content="Goes"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="https://allenxuxu.github.io/go/"><meta name=twitter:card content="summary"><meta name=twitter:title content="Goes"><meta name=twitter:description content><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Goes","item":"https://allenxuxu.github.io/go/"}]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(255, 255, 255, 0.84);--secondary:rgba(255, 255, 255, 0.56);--tertiary:rgba(255, 255, 255, 0.16);--content:rgba(255, 255, 255, 0.74);--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://allenxuxu.github.io/ accesskey=h title="徐旭 的博客 (Alt + H)">徐旭 的博客</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu onscroll=menu_on_scroll()><li><a href=https://allenxuxu.github.io/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://allenxuxu.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://allenxuxu.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://allenxuxu.github.io/about/ title="About Me"><span>About Me</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://allenxuxu.github.io/>Home</a></div><h1>Goes</h1></header><article class=post-entry><header class=entry-header><h2>Golang slice map channel 小技巧</h2></header><section class=entry-content><p>Slice vs Array Slice 和 Array 是不同的类型 package main func main() { s := make([]int, 100) printSlice(s) var a [100]int printArray(a) } func printSlice(s []int) { println(len(s)) // 100 println(cap(s)) // 100 } func printArray(a [100]int) { println(len(a)) // 100 println(cap(a)) // 100 } Slice 结构体
type slice struct { array unsafe.Pointer len int cap int } 下面的汇编表明，当类型是 slice 的时候，打印 len 或者 cap 的时候，会去栈上取数据:
MOVQ 0x28(SP), AX MOVQ AX, 0x8(SP) CALL 0xbfc [1:5]R_CALL:runtime....</p></section><footer class=entry-footer>April 17, 2021&nbsp;·&nbsp;3 min&nbsp;·&nbsp;徐旭</footer><a class=entry-link aria-label="post link to Golang slice map channel 小技巧" href=https://allenxuxu.github.io/go/go-slice-map-channel/></a></article><article class=post-entry><header class=entry-header><h2>go chan 实用示例</h2></header><section class=entry-content><p>尝试发送 select { case c &lt;- struct{}{}: default: fmt.Println("chan 已满，发送不成功") } 尝试接收 select { case v := &lt;- c: default: fmt.Println("chan 中没有信息，接收不成功") } 标准编译器对尝试发送和尝试接收代码块做了特别的优化，使得它们的执行效率比多 case分支的普通 select代码块执行效率高得多。
无阻塞的检查一个 chan 是否关闭 假设我们可以保证没有任何协程会向一个通道发送数据，则我们可以使用下面的代码来（并发安全地）检查此通道是否已经关闭，此检查不会阻塞当前协程。
func IsClosed(c chan struct{}) bool { select { case &lt;-c: return true default: } return false } 最快回应 package main import ( "fmt" "math/rand" "time" ) func source(c chan&lt;- int, id int) { rb := rand....</p></section><footer class=entry-footer>May 30, 2020&nbsp;·&nbsp;1 min&nbsp;·&nbsp;徐旭</footer><a class=entry-link aria-label="post link to go chan 实用示例" href=https://allenxuxu.github.io/go/go-channel/></a></article><article class=post-entry><header class=entry-header><h2>Uber Go 风格指南</h2></header><section class=entry-content><p>Uber Go 风格指南 译文：https://github.com/Allenxuxu/uber-go-guide 原文：https://github.com/uber-go/guide/blob/master/style.md 简介 风格是指规范代码的共同约定。风格一词其实是有点用词不当的，因为共同约定的范畴远远不止 gofmt 所做的源代码格式化这些。
本指南旨在通过详尽描述 Uber 在编写 Go 代码中的注意事项（规定）来解释其中复杂之处。制定这些注意事项（规定）是为了提高代码可维护性同时也让工程师们高效的使用 Go 的特性。
这份指南最初由 Prashant Varanasi 和 Simon Newton 编写，目的是让一些同事快速上手 Go 。多年来，已经根据其他人的反馈不断修改。
这份文档记录了我们在 Uber 遵守的 Go 惯用准则。其中很多准则是 Go 的通用准则，其他方面依赖于外部资源：
Effective Go The Go common mistakes guide 所有的代码都应该通过 golint 和 go vet 检查。我们建议您设置编辑器：
保存时自动运行 goimports 自动运行 golint 和 go vet 来检查错误 您可以在这找到关于编辑器设定 Go tools 的相关信息：
https://github.com/golang/go/wiki/IDEsAndTextEditorPlugins
指南 指向接口（interface）的指针 你基本永远不需要一个指向接口的指针。你应该直接将接口作为值传递，因为接口的底层数据就是指针。
一个接口包含两个字段：
类型指针，指向某些特定类型信息的指针。 数据指针。如果存储数据是一个指针变量，那就直接存储。如果存储数据是一个值变量，那就存储指向该值的指针。 如果你需要接口方法来修改这些底层数据，那你必须使用指针。...</p></section><footer class=entry-footer>October 13, 2019&nbsp;·&nbsp;13 min&nbsp;·&nbsp;徐旭</footer><a class=entry-link aria-label="post link to Uber Go 风格指南" href=https://allenxuxu.github.io/go/uber-go-guide/></a></article><article class=post-entry><header class=entry-header><h2>Go net/http 浅析</h2></header><section class=entry-content><p>GO HTTP Server 使用标准库构建 HTTP 服务 Go 语言标准库自带一个完善的 net/http 包，可以很方便编写一个可以直接运行的 Web 服务。
package main import ( "log" "net/http" ) func hello(w http.ResponseWriter, r *http.Request) { log.Println(r.Method, r.Host, r.RequestURI) w.Write([]byte("hello")) } func main() { http.HandleFunc("/hello", hello) //设置访问的路由 // http.Handle("/hello", http.HandlerFunc(hello)) // 和上面写法等价 err := http.ListenAndServe(":9090", nil) //设置监听的端口并启动 HTTP 服务 if err != nil { log.Fatal("ListenAndServe: ", err) } } $ curl -v 127.0.0.1:9090/hello * Trying 127.0.0.1... * TCP_NODELAY set * Connected to 127....</p></section><footer class=entry-footer>September 15, 2019&nbsp;·&nbsp;6 min&nbsp;·&nbsp;徐旭</footer><a class=entry-link aria-label="post link to Go net/http 浅析" href=https://allenxuxu.github.io/go/go-http/></a></article><article class=post-entry><header class=entry-header><h2>Go channel 拷贝问题</h2></header><section class=entry-content><p>Go 的 channel 使用非常方便，但是总听说 channel 会拷贝传递的数据，生怕频繁拷贝影响效率。
究竟是怎么个拷贝法呢，下面会有两个 demo 验证下。
先说结论： Go channel 的发送接收数据的拷贝和 Go 的函数传参道理是一样的，都是默认的值拷贝。 如果你传递一个值，那么 Go 会复制一份新的；如果传递一个指针，则会拷贝这个指针，不会去拷贝这个指针所指的变量（这一点 C++ 选手可能会理解比较深）。
所以，如果你需要通过 channel 传递一个很大的 struct ，那么应该传递 指针。但是，要非常注意通过 channel 发送后，不要修改这个指，这会导致线程间潜在的竞争。
下面是两个验证的小 demo：
通过 channel 传递指针 package main import ( "fmt" "time" ) func recv(ch &lt;-chan *int) { time.Sleep(1 * time.Second) out := &lt;-ch fmt.Println("recv : ", out, *out) } func main() { i := 1 ch := make(chan *int, 2) fmt....</p></section><footer class=entry-footer>August 21, 2019&nbsp;·&nbsp;1 min&nbsp;·&nbsp;徐旭</footer><a class=entry-link aria-label="post link to Go channel 拷贝问题" href=https://allenxuxu.github.io/go/go-channel-copy/></a></article><article class=post-entry><header class=entry-header><h2>拥抱 Go module</h2></header><section class=entry-content><p>go get 拉包一直时国内选手头疼的问题，虽然梯子可以解决问题，但是总是有很慢的时候，而且需要每台电脑都配置，特别是 CI 的服务器等，很烦人。
七牛云开源了 goproxy ，还免费提供 https://goproxy.cn 作为代理来拉包。
不过 GOPROXY 只有在 Go module 下才能使用，索性全面拥抱 Go module 一劳永逸。
修改一下配置文件，即可：
sudo vi /etc/profile 在最后添加如下内容，开启 Go module 和代理：
export GO111MODULE=on export GOPROXY=https://goproxy.cn 让配置文件立即生效
source /etc/profile 接下来就可以畅快 Go 了！
PS： Go 1.16 已经默认开启 go moudle了。</p></section><footer class=entry-footer>August 20, 2019&nbsp;·&nbsp;1 min&nbsp;·&nbsp;徐旭</footer><a class=entry-link aria-label="post link to 拥抱 Go module" href=https://allenxuxu.github.io/go/go-module/></a></article><article class=post-entry><header class=entry-header><h2>Golang 极简入门教程</h2></header><section class=entry-content><p>Hello World 我们以传统的“hello world”案例开始吧。
package main import "fmt" func main() { fmt.Println("Hello World") } Go的源文件以 .go 为后缀名，这些文件名均由小写字母（推荐做法）组成且不包含空格和其他特殊字符，如 main.go 。如果文件名由多个部分组成，则使用下划线 _ 对它们进行分隔，如 main_test.go 。
Go是一门编译型语言,Go语言的工具链将源代码及其依赖转换成计算机的机器指令。Go语言提供的工具都通过一个单独的命令 go 调用，go 命令有一系列子命令。
$ go help Go is a tool for managing Go source code. Usage: go &lt;command> [arguments] The commands are: bug start a bug report build compile packages and dependencies clean remove object files and cached files doc show documentation for package or symbol env print Go environment information fix update packages to use new APIs fmt gofmt (reformat) package sources generate generate Go files by processing source get download and install packages and dependencies install compile and install packages and dependencies list list packages or modules mod module maintenance run compile and run Go program test test packages tool run specified go tool version print Go version vet report likely mistakes in packages ....</p></section><footer class=entry-footer>August 4, 2019&nbsp;·&nbsp;13 min&nbsp;·&nbsp;徐旭</footer><a class=entry-link aria-label="post link to Golang 极简入门教程" href=https://allenxuxu.github.io/go/go-tutorials/></a></article><article class=post-entry><header class=entry-header><h2>Golang实现默认参数</h2></header><section class=entry-content><p>在golang 中是不支持默认参数的，micro中有一种优雅的实现方法(并非 micro 首创)，叫做 Functional Options Patter。Functional Options 可以用来实现简洁的支持默认参数的函数方法。
options package server import ( "time" ) type Options struct { ConnectTimeOut time.Duration Name string Address string } type Option func(*Options) func newOptions(opt ...Option) Options { opts := Options{} for _, o := range opt { o(&opts) } if len(opts.Address) == 0 { opts.Address = DefaultAddress } if len(opts.Name) == 0 { opts.Name = DefaultName } if opts.ConnectTimeOut == time.Duration(0) { opts....</p></section><footer class=entry-footer>June 27, 2019&nbsp;·&nbsp;2 min&nbsp;·&nbsp;徐旭</footer><a class=entry-link aria-label="post link to Golang实现默认参数" href=https://allenxuxu.github.io/go/go-options/></a></article></main><footer class=footer><span>&copy; 2021 <a href=https://allenxuxu.github.io/>徐旭 的博客</a></span>
<span>&#183;</span>
<span>Powered by <a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a></span>
<span>&#183;</span>
<span>Theme <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>window.onload=function(){localStorage.getItem("menu-scroll-position")&&(document.getElementById('menu').scrollLeft=localStorage.getItem("menu-scroll-position"))};function menu_on_scroll(){localStorage.setItem("menu-scroll-position",document.getElementById('menu').scrollLeft)}document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script></body></html>